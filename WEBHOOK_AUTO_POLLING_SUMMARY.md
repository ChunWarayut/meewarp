# р╕кр╕гр╕╕р╕Ыр╕Бр╕▓р╕гр╣Бр╕Бр╣Йр╣Др╕Вр╕Ыр╕▒р╕Нр╕лр╕▓ Webhook р╣Др╕бр╣И Trigger р╕лр╕Щр╣Йр╕▓ Payment

## ЁЯФ┤ р╕Ыр╕▒р╕Нр╕лр╕▓
р╕лр╕ер╕▒р╕Зр╕Ир╕▓р╕Бр╕кр╣Бр╕Бр╕Щ QR PromptPay р╣Бр╕ер╕░р╕Кр╕│р╕гр╕░р╣Ар╕Зр╕┤р╕Щр╕кр╕│р╣Ар╕гр╣Зр╕И:
- тЬЕ Webhook р╕Чр╕│р╕Зр╕▓р╕Щр╕Ыр╕Бр╕Хр╕┤ (р╕нр╕▒р╕Юр╣Ар╕Фр╕Ч DB)
- тЭМ р╕лр╕Щр╣Йр╕▓ QR Payment р╣Др╕бр╣Ир╕нр╕▒р╕Юр╣Ар╕Фр╕Чр╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤
- тЭМ р╕Хр╣Йр╕нр╕Зр╕Бр╕Фр╕Ыр╕╕р╣Ир╕б "р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕кр╕Цр╕▓р╕Щр╕░" р╕Фр╣Йр╕зр╕вр╕Хр╕Щр╣Ар╕нр╕З

## тЬЕ р╕зр╕┤р╕Шр╕╡р╣Бр╕Бр╣Йр╣Др╕В
р╣Ар╕Юр╕┤р╣Ир╕б **Auto-Polling** р╕Чр╕╕р╕Бр╣Ж 3 р╕зр╕┤р╕Щр╕▓р╕Чр╕╡ + Visual Indicator

## ЁЯУБ р╣Др╕Яр╕ер╣Мр╕Чр╕╡р╣Ир╣Бр╕Бр╣Йр╣Др╕В

### 1. `/client/src/pages/PromptPayPage.tsx`
- тЬЕ р╣Ар╕Юр╕┤р╣Ир╕б auto-polling useEffect (р╕Чр╕╕р╕Бр╣Ж 3 р╕зр╕┤р╕Щр╕▓р╕Чр╕╡)
- тЬЕ р╣Ар╕Юр╕┤р╣Ир╕б visual indicator "р╕Бр╕│р╕ер╕▒р╕Зр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕кр╕Цр╕▓р╕Щр╕░р╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤..."
- тЬЕ р╣Бр╕кр╕Фр╕З Thank You Modal р╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤р╣Ар╕бр╕╖р╣Ир╕нр╕Кр╕│р╕гр╕░р╣Ар╕Зр╕┤р╕Щр╕кр╕│р╣Ар╕гр╣Зр╕И

### 2. `/client/src/components/customer/CustomerWarpModal.tsx`
- тЬЕ р╣Ар╕Юр╕┤р╣Ир╕б auto-polling useEffect
- тЬЕ р╣Ар╕Юр╕┤р╣Ир╕б visual indicator
- тЬЕ р╕лр╕вр╕╕р╕Ф polling р╣Ар╕бр╕╖р╣Ир╕нр╕Ыр╕┤р╕Ф modal

## ЁЯОп р╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М

| р╕Бр╣Ир╕нр╕Щр╣Бр╕Бр╣Йр╣Др╕В | р╕лр╕ер╕▒р╕Зр╣Бр╕Бр╣Йр╣Др╕В |
|-----------|-----------|
| тЭМ р╕Хр╣Йр╕нр╕Зр╕Бр╕Фр╕Ыр╕╕р╣Ир╕бр╣Ар╕нр╕З | тЬЕ р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤ |
| тЭМ р╣Др╕бр╣Ир╕бр╕╡р╕Бр╕▓р╕гр╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щ | тЬЕ р╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щр╕Чр╕▒р╕Щр╕Чр╕╡ (р╕ар╕▓р╕вр╣Гр╕Щ 3 р╕зр╕┤р╕Щр╕▓р╕Чр╕╡) |
| тЭМ UX р╣Др╕бр╣Ир╕Фр╕╡ | тЬЕ UX р╕Фр╕╡р╣Ар╕вр╕╡р╣Ир╕вр╕б |

## ЁЯзк р╕зр╕┤р╕Шр╕╡р╕Чр╕Фр╕кр╕нр╕Ъ

1. р╣Ар╕Ыр╕┤р╕Фр╕лр╕Щр╣Йр╕▓ Self Warp Page
2. р╣Ар╕ер╕╖р╕нр╕Б "PromptPay QR" р╣Бр╕ер╕░ Submit
3. р╕кр╕▒р╕Зр╣Ар╕Бр╕Х indicator "р╕Бр╕│р╕ер╕▒р╕Зр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕кр╕Цр╕▓р╕Щр╕░р╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤..."
4. р╕кр╣Бр╕Бр╕Щ QR р╣Бр╕ер╕░р╕Кр╕│р╕гр╕░р╣Ар╕Зр╕┤р╕Щ
5. **р╕ар╕▓р╕вр╣Гр╕Щ 3 р╕зр╕┤р╕Щр╕▓р╕Чр╕╡** тЖТ р╣Бр╕кр╕Фр╕З "р╕Кр╕│р╕гр╕░р╣Ар╕Зр╕┤р╕Щр╣Ар╕гр╕╡р╕вр╕Ър╕гр╣Йр╕нр╕вр╣Бр╕ер╣Йр╕з!" + Thank You Modal

## тЪб Performance

- **Polling Interval:** 3 р╕зр╕┤р╕Щр╕▓р╕Чр╕╡
- **API Calls:** 20 requests/р╕Щр╕▓р╕Чр╕╡/р╕Ьр╕╣р╣Йр╣Гр╕Кр╣Й
- **р╕лр╕вр╕╕р╕Ф Polling р╣Ар╕бр╕╖р╣Ир╕н:** р╕Кр╕│р╕гр╕░р╣Ар╕Зр╕┤р╕Щр╕кр╕│р╣Ар╕гр╣Зр╕И р╕лр╕гр╕╖р╕н component unmount

## ЁЯУЪ р╣Ар╕нр╕Бр╕кр╕▓р╕гр╣Ар╕Юр╕┤р╣Ир╕бр╣Ар╕Хр╕┤р╕б

р╕Фр╕╣р╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Фр╣Ар╕Хр╣Зр╕бр╣Гр╕Щ: `/docs/WEBHOOK_AUTO_POLLING_FIX.md`

---

**Date:** 2025-10-25  
**Status:** тЬЕ р╣Ар╕кр╕гр╣Зр╕Ир╕кр╕бр╕Ър╕╣р╕гр╕Ур╣М  
**Tested:** тЬЕ No linter errors

